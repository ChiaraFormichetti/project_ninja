<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Async pratica</title>
</head>
<body>
    <button>Vai</button>
    <script>
       /* //esecusione sync prima clicchi esce l'alert e poi si crea il paragrafo
        //=> finchè c'è l'alert non può andare a fare il seguito poichè il thread principale è occupato
        //non c'è spazio per fare altro in background
        //allora usiamo il codice asyncrono con fetch()
        const btn = document.querySelector('button');
        btn.addEventListener('click',()=>{
            alert('You clicked me!');
            let pElem = document.createElement('p');
            pElem.textContent = 'This is a newly-added paragraph.';
            document.body.appendChild(pElem);
        });

        let response = fetch("//indirizzo di un'immagine")
        //il blob è un tipo di dato molto grande, come un'immagine
        //ci dà errore perchè ancora non abbiamo l'immagine, le due richieste avvengono insieme ma ancora non abbiamo risposta
        //il blob è qualcosa di pendente
        let blob = response.blob();
        //Facciamo una prova con le asincrone con il back, che è un metodo un p più datato
        //le callback sono funzioni a ritroso, le chiamiamo prima di finire determinate cose 
        //funzione carica asset
        function loadAsset(url,type,callback){
            //apre l'XML per caricare il json
            let xhr = new XMLHttpRequest();
            //apriamo la richiesta xhr con il get in cui andiamo a prendere l'immagine
            xhr.open('GET',url);
            //type=blob
            //aggiungiamo il tipo di risposta
            xhr.responseType = type;
            //una volta che ha caricato la risposta e ha tirato giù l'immagine che ci serve fa la funzione callback 
            
            xhr.onload = function(){
                callback(xhr.response);
             };
             //e ci mette dentro la risposta=>fa partire il display image
             xhr.send();
            }
            //le callback sono funzioni che avvengono una volta che avremmo finito di fare determinate cose
            //in questo caso una volta che è stata caricata la foto
        function displayImage(blob){
            //crea un elemento immagine, lo mette nel body e ci piazza dentro l'url dell'immagine che ha tirato giù
            let objectURL = URL.createObjectURL(blob);
            let image = document.createElement('img');
            image.src = objectURL;
            document.body.appendChild(image);
        }
        loadAsset("url di un qualcosa tipo immagine",'blob','displayImage');
        //Le callback sono un metodo un pò ormai datato
        //Ormai si usa solo il fetch*/
        //e le promise con then e catch che ci permettono di gestire la async
        //va a prendere una cartella json dopodichè (callback) prendi la risposta e me lo ritorni come risposta.json
        //quindi me lo rendi leggibile
        fetch('utente.json').then(function(response){
            return response.json();
            //dopodichè prendi il json e lo butti in una classe js
        }).then(function(json){
            classe = json;
            console.log('Dati: ',classe)
            //il catch serve per prendere l'errore, nel caso in cui quello che avviene prima dà errore 
            //il catch lo cattura e lo stampa
        }).catch(function(err){
            console.log('Fetch problem: '+err.message);
        });
        //questo è il codice asincrono di ultima generazione
    </script>
    
</body>
</html>